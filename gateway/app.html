<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>DrinkQR å°åˆ·ã‚µãƒ¼ãƒãƒ¼</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: white;
      min-height: 100vh;
      padding: 30px;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }
    .header p {
      color: #888;
      font-size: 14px;
    }
    .status {
      background: #0f3460;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #1a1a3e;
    }
    .status-row:last-child {
      border-bottom: none;
    }
    .status-label {
      color: #888;
      font-size: 14px;
    }
    .status-value {
      font-weight: bold;
      font-size: 16px;
    }
    .status-value.connected {
      color: #4ade80;
    }
    .status-value.disconnected {
      color: #f87171;
    }
    .log-container {
      background: #0a0a1a;
      border-radius: 12px;
      padding: 20px;
      height: 250px;
      overflow-y: auto;
    }
    .log-container h3 {
      font-size: 14px;
      color: #888;
      margin-bottom: 15px;
    }
    .log-item {
      padding: 8px 12px;
      margin-bottom: 8px;
      border-radius: 6px;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
    }
    .log-item.success {
      background: rgba(74, 222, 128, 0.1);
      border-left: 3px solid #4ade80;
    }
    .log-item.error {
      background: rgba(248, 113, 113, 0.1);
      border-left: 3px solid #f87171;
    }
    .log-item.info {
      background: rgba(96, 165, 250, 0.1);
      border-left: 3px solid #60a5fa;
    }
    .log-time {
      color: #666;
      font-size: 11px;
    }
    .footer {
      text-align: center;
      margin-top: 20px;
      color: #555;
      font-size: 12px;
    }
    .empty-log {
      color: #555;
      text-align: center;
      padding: 40px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ–¨ï¸ DrinkQR å°åˆ·ã‚µãƒ¼ãƒãƒ¼</h1>
    <p>æ³¨æ–‡ãŒæ¥ã‚‹ã¨è‡ªå‹•ã§å°åˆ·ã—ã¾ã™</p>
  </div>

  <div class="status">
    <div class="status-row">
      <span class="status-label">æ¥ç¶šçŠ¶æ…‹</span>
      <span id="connectionStatus" class="status-value disconnected">æ¥ç¶šä¸­...</span>
    </div>
    <div class="status-row">
      <span class="status-label">æœ¬æ—¥ã®å°åˆ·æ•°</span>
      <span id="printCount" class="status-value">0</span>
    </div>
    <div class="status-row">
      <span class="status-label">æœ€çµ‚å°åˆ·</span>
      <span id="lastPrint" class="status-value">-</span>
    </div>
  </div>

  <div class="log-container">
    <h3>å°åˆ·ãƒ­ã‚°</h3>
    <div id="logList">
      <div class="empty-log">æ³¨æ–‡ã‚’å¾…ã£ã¦ã„ã¾ã™...</div>
    </div>
  </div>

  <div class="footer">
    ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¯é–‰ã˜ã¦ã‚‚å‹•ãç¶šã‘ã¾ã™ï¼ˆã‚¿ã‚¹ã‚¯ãƒãƒ¼ã«æ®‹ã‚Šã¾ã™ï¼‰
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    let printCount = 0;
    const logList = document.getElementById('logList');
    const connectionStatus = document.getElementById('connectionStatus');
    const printCountEl = document.getElementById('printCount');
    const lastPrintEl = document.getElementById('lastPrint');

    function addLog(message, type = 'info') {
      // ç©ºã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
      const emptyLog = logList.querySelector('.empty-log');
      if (emptyLog) emptyLog.remove();

      const time = new Date().toLocaleTimeString('ja-JP');
      const item = document.createElement('div');
      item.className = `log-item ${type}`;
      item.innerHTML = `
        <span>${message}</span>
        <span class="log-time">${time}</span>
      `;
      logList.insertBefore(item, logList.firstChild);

      // æœ€å¤§50ä»¶
      while (logList.children.length > 50) {
        logList.removeChild(logList.lastChild);
      }
    }

    ipcRenderer.on('connection-status', (event, status) => {
      if (status === 'SUBSCRIBED') {
        connectionStatus.textContent = 'æ¥ç¶šæ¸ˆã¿';
        connectionStatus.className = 'status-value connected';
        addLog('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¾ã—ãŸ', 'success');
      } else {
        connectionStatus.textContent = status;
        connectionStatus.className = 'status-value disconnected';
      }
    });

    ipcRenderer.on('new-order', (event, order) => {
      addLog(`æ–°è¦æ³¨æ–‡: #${order.id.slice(-6).toUpperCase()}`, 'info');
    });

    ipcRenderer.on('print-success', (event, data) => {
      printCount++;
      printCountEl.textContent = printCount;
      lastPrintEl.textContent = new Date().toLocaleTimeString('ja-JP');
      addLog(`å°åˆ·å®Œäº†: #${data.id.slice(-6).toUpperCase()}`, 'success');
    });

    ipcRenderer.on('print-error', (event, data) => {
      addLog(`å°åˆ·å¤±æ•—: #${data.id.slice(-6).toUpperCase()} - ${data.error}`, 'error');
    });

    ipcRenderer.on('server-started', (event, data) => {
      addLog('å°åˆ·ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ãŸ', 'info');
    });
  </script>
</body>
</html>
