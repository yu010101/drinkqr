# テスト仕様書

## 1. テスト対象機能

### 1.1 注文UI（`/t/[table]`）

#### 正常系テスト
- [ ] 有効なテーブル名でアクセス → メニューが表示される
- [ ] メニューアイテムを選択して数量を指定 → 注文ボタンが有効になる
- [ ] 注文送信 → 成功メッセージが表示される
- [ ] 複数アイテムを選択して注文 → すべてのアイテムが送信される
- [ ] 数量を変更して注文 → 正しい数量で送信される

#### 異常系テスト
- [ ] 無効なテーブル名（空文字） → エラーメッセージ表示
- [ ] 無効なテーブル名（特殊文字） → エラーメッセージ表示
- [ ] メニューが空 → エラーメッセージ表示
- [ ] アイテム未選択で注文ボタンクリック → エラーメッセージ表示
- [ ] 数量0で注文 → エラーメッセージ表示
- [ ] 数量101で注文 → エラーメッセージ表示
- [ ] ネットワークエラー時 → エラーメッセージ表示

### 1.2 API Route（`POST /api/orders`）

#### 正常系テスト
- [ ] 有効なリクエスト → 200 OK, `{ success: true, order_id: "uuid" }`
- [ ] `orders` テーブルに正しくINSERTされる
- [ ] `print_jobs` テーブルに正しくINSERTされる（`status='queued'`）
- [ ] `printable_text` が正しく生成される

#### 異常系テスト
- [ ] `table` が空 → 400 Bad Request
- [ ] `table` が英数字以外 → 400 Bad Request
- [ ] `table` が11文字以上 → 400 Bad Request
- [ ] `items` が空配列 → 400 Bad Request
- [ ] `items[].name` が空 → 400 Bad Request
- [ ] `items[].name` が101文字以上 → 400 Bad Request
- [ ] `items[].qty` が0 → 400 Bad Request
- [ ] `items[].qty` が101 → 400 Bad Request
- [ ] `items[].qty` が小数 → 400 Bad Request
- [ ] リクエストボディが不正なJSON → 400 Bad Request
- [ ] データベース接続エラー → 500 Internal Server Error
- [ ] タイムアウト → 504 Gateway Timeout

### 1.3 印刷フォーマット

#### 正常系テスト
- [ ] 印刷テキストが正しいフォーマットで生成される
- [ ] テーブル名が正しく含まれる
- [ ] 時刻が正しい形式で含まれる
- [ ] アイテムリストが正しく含まれる
- [ ] 複数アイテムが正しく並ぶ

## 2. テストデータ

### 2.1 有効なテーブル名
- `A1`
- `B10`
- `Table1`
- `1`

### 2.2 無効なテーブル名
- `` (空文字)
- `A-1` (ハイフン)
- `A_1` (アンダースコア)
- `A 1` (スペース)
- `A1B2C3D4E5F` (11文字)

### 2.3 有効な注文リクエスト
```json
{
  "table": "A1",
  "items": [
    { "name": "生ビール", "qty": 1 },
    { "name": "ハイボール", "qty": 2 }
  ]
}
```

### 2.4 無効な注文リクエスト例
- `table` が空
- `items` が空配列
- `items[].qty` が0
- `items[].qty` が101
- `items[].name` が空

## 3. テスト環境

### 3.1 前提条件
- Next.js開発サーバーが起動している
- Supabaseが設定されている（テスト用プロジェクト）
- テスト用データベースが初期化されている

### 3.2 テスト実行コマンド
```bash
npm run test:e2e
```

## 4. テストカバレッジ目標

- 正常系: 100%
- 異常系: 100%
- エッジケース: 80%以上
